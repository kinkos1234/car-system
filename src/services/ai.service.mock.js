/**
 * AI ì„œë¹„ìŠ¤ ëª©ì—… - í¬íŠ¸í´ë¦¬ì˜¤ìš© ë”ë¯¸ ë°ì´í„°
 * ì‹¤ì œ OpenAI API í˜¸ì¶œ ì—†ì´ ë¯¸ë¦¬ ìƒì„±ëœ ì‘ë‹µì„ ë°˜í™˜
 */

// ë”ë¯¸ AI ì‘ë‹µ ë°ì´í„°ë² ì´ìŠ¤
const MOCK_SUMMARIES = {
  'AutoMaker': {
    summary: `AutoMaker ê³ ê°ì‚¬ì˜ ì£¼ìš” ì´ìŠˆ ë¶„ì„ ê²°ê³¼:

1. **ë‚©ê¸° ì§€ì—° ë¬¸ì œ** (ë°˜ë³µ 8íšŒ)
   - ì£¼ìš” ì›ì¸: ê¸€ë¡œë²Œ ë¶€í’ˆ ê³µê¸‰ë§ ë¶ˆì•ˆì •
   - ì˜í–¥ë„: ë†’ìŒ (í‰ê·  ì ìˆ˜ 4.2)

2. **í’ˆì§ˆ ê´€ë¦¬ ì´ìŠˆ** (5ê±´)
   - ë„ì¥ ê³µì • ë¶ˆëŸ‰ë¥  ì¦ê°€
   - ê³ ê° ë§Œì¡±ë„ í•˜ë½ ìš°ë ¤

3. **ì„¤ê³„ ë³€ê²½ ìš”ì²­** (3ê±´)
   - ì‹ ê·œ ì•ˆì „ ê·œì • ëŒ€ì‘
   - í”„ë¡œì„¸ìŠ¤ í‘œì¤€í™” í•„ìš”

4. **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ê°œì„  í•„ìš”**
   - ë‹´ë‹¹ì ë³€ê²½ìœ¼ë¡œ ì¸í•œ ì •ë³´ ë‹¨ì ˆ
   - ì •ê¸° ë¯¸íŒ… ì²´ê³„ ì¬êµ¬ì¶• ìš”êµ¬

5. **ë¹„ìš© ìµœì í™” ì••ë°•**
   - ì›ìì¬ ê°€ê²© ìƒìŠ¹ ëŒ€ì‘
   - ëŒ€ì²´ ê³µê¸‰ì‚¬ ê²€í†  ì§„í–‰ ì¤‘`,
    topIssues: [
      { title: 'ë¶€í’ˆ ê³µê¸‰ ì§€ì—°', plan: 'ëŒ€ì²´ ê³µê¸‰ì‚¬ ê³„ì•½ ê²€í† ', score: 4.5 },
      { title: 'ë„ì¥ í’ˆì§ˆ ë¶ˆëŸ‰', plan: 'ê³µì • ê°œì„  íšŒì˜ ì˜ˆì •', score: 4.2 },
      { title: 'ì„¤ê³„ ë³€ê²½ ëŒ€ì‘', plan: 'ê¸°ìˆ íŒ€ ì¶”ê°€ ë°°ì •', score: 3.8 },
      { title: 'ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ê°œì„ ', plan: 'ì£¼ê°„ ë¯¸íŒ… ì²´ê³„ ë„ì…', score: 3.5 },
      { title: 'ë¹„ìš© ì ˆê° ìš”êµ¬', plan: 'ì›ê°€ ë¶„ì„ ë³´ê³ ì„œ ì‘ì„±', score: 3.2 }
    ]
  },
  'TechSupplier': {
    summary: `TechSupplier ê³ ê°ì‚¬ì˜ ì´ìŠˆ ìš”ì•½:

1. **ê¸°ìˆ  ì§€ì› ìš”ì²­ ì¦ê°€**
   - ì‹ ê·œ ì œí’ˆ ë„ì… ê´€ë ¨ ë¬¸ì˜
   - ê¸°ìˆ  êµìœ¡ í”„ë¡œê·¸ë¨ ìš”ì²­

2. **ë‚©ê¸° ì¼ì • í˜‘ì˜**
   - í”„ë¡œì íŠ¸ ì¼ì • ì¡°ì • í•„ìš”
   - ìš°ì„ ìˆœìœ„ ì¬ì¡°ì • ìš”êµ¬

3. **í’ˆì§ˆ ê¸°ì¤€ ê°•í™”**
   - ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ í”„ë¡œí† ì½œ ì ìš©
   - ì¸ì¦ íšë“ ì§€ì› í•„ìš”`,
    topIssues: [
      { title: 'ê¸°ìˆ  êµìœ¡ ì§€ì›', plan: 'ì „ë¬¸ê°€ íŒŒê²¬ ì˜ˆì •', score: 3.8 },
      { title: 'ë‚©ê¸° ì¼ì • ì¡°ì •', plan: 'í”„ë¡œì íŠ¸ íƒ€ì„ë¼ì¸ ì¬ê²€í† ', score: 3.5 },
      { title: 'í’ˆì§ˆ ì¸ì¦ ì§€ì›', plan: 'ì¸ì¦ ì»¨ì„¤íŒ… ì œê³µ', score: 3.2 }
    ]
  }
};

const MOCK_STRATEGIES = {
  'AutoMaker': {
    aiRecommendation: `[ì „ëµëª…]: ê³µê¸‰ë§ ì•ˆì •í™” ë° í’ˆì§ˆ ê°œì„  í†µí•© ì „ëµ
[ëŒ€ìƒ]: AutoMaker êµ¬ë§¤íŒ€ ë° í’ˆì§ˆê´€ë¦¬íŒ€
[ìš”ì•½]: ë°˜ë³µì ì¸ ë‚©ê¸° ì§€ì—°ê³¼ í’ˆì§ˆ ì´ìŠˆë¡œ ì¸í•œ ê³ ê° ë§Œì¡±ë„ í•˜ë½ ìš°ë ¤. ê·¼ë³¸ì ì¸ ê³µê¸‰ë§ ì¬êµ¬ì¶•ê³¼ í’ˆì§ˆ ê´€ë¦¬ ì²´ê³„ ê°•í™”ê°€ ì‹œê¸‰í•œ ìƒí™©.
[ì¡°ì¹˜]: 1) í•µì‹¬ ë¶€í’ˆ 2ì°¨ ê³µê¸‰ì‚¬ í™•ë³´, 2) í’ˆì§ˆ ê²Œì´íŠ¸ ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ë„ì…, 3) ì£¼ê°„ ì§„ë„ ì ê²€ íšŒì˜ ì •ë¡€í™”
[ì˜ˆìƒ íš¨ê³¼]: ë‚©ê¸° ì¤€ìˆ˜ìœ¨ 95% ë‹¬ì„±, í’ˆì§ˆ ë¶ˆëŸ‰ë¥  50% ê°ì†Œ, ê³ ê° ë§Œì¡±ë„ 20% í–¥ìƒ ê¸°ëŒ€

[ì „ëµëª…]: ë””ì§€í„¸ í˜‘ì—… í”Œë«í¼ êµ¬ì¶•
[ëŒ€ìƒ]: í”„ë¡œì íŠ¸ ê´€ë¦¬íŒ€ ë° ê³ ê°ì‚¬ ë‹´ë‹¹ì
[ìš”ì•½]: ë‹´ë‹¹ì ë³€ê²½ê³¼ ì •ë³´ ê³µìœ  ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë‹¨ì ˆ ë¬¸ì œ ì‹¬í™”. ì‹¤ì‹œê°„ ì •ë³´ ê³µìœ  ì²´ê³„ í•„ìš”.
[ì¡°ì¹˜]: 1) í”„ë¡œì íŠ¸ ê´€ë¦¬ íˆ´ ë„ì…, 2) ì‹¤ì‹œê°„ ì§„ë„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•, 3) ì›”ê°„ ìŠ¤í…Œì´í¬í™€ë” ë¯¸íŒ… ê°œìµœ
[ì˜ˆìƒ íš¨ê³¼]: ì •ë³´ ì „ë‹¬ ì˜¤ë¥˜ 80% ê°ì†Œ, ì˜ì‚¬ê²°ì • ì†ë„ 30% í–¥ìƒ, ê³ ê°ì‚¬ ì‹ ë¢°ë„ ì œê³ 

[ì „ëµëª…]: ë¹„ìš© ìµœì í™” ë° ê°€ì¹˜ ì—”ì§€ë‹ˆì–´ë§
[ëŒ€ìƒ]: ì„¤ê³„íŒ€ ë° êµ¬ë§¤íŒ€
[ìš”ì•½]: ì›ìì¬ ê°€ê²© ìƒìŠ¹ê³¼ ê³ ê°ì‚¬ì˜ ë¹„ìš© ì ˆê° ì••ë°•ìœ¼ë¡œ ìˆ˜ìµì„± ì•…í™” ìš°ë ¤. ê°€ì¹˜ ì¤‘ì‹¬ì˜ ë¹„ìš© ê´€ë¦¬ ì „ëµ í•„ìš”.
[ì¡°ì¹˜]: 1) VA/VE ë¶„ì„ì„ í†µí•œ ì„¤ê³„ ìµœì í™”, 2) ì¥ê¸° ê³„ì•½ ê¸°ë°˜ ì›ê°€ ì•ˆì •í™”, 3) ê³ ê°ì‚¬ì™€ Win-Win ê°€ê²© ëª¨ë¸ ê°œë°œ
[ì˜ˆìƒ íš¨ê³¼]: ì›ê°€ ì ˆê° 15% ë‹¬ì„±, ê³ ê° ë§Œì¡±ë„ ìœ ì§€í•˜ë©° ìˆ˜ìµì„± ê°œì„ , ì¥ê¸° íŒŒíŠ¸ë„ˆì‹­ ê°•í™”`,
    parsedStrategy: {
      ì „ëµëª…: 'ê³µê¸‰ë§ ì•ˆì •í™” ë° í’ˆì§ˆ ê°œì„  í†µí•© ì „ëµ',
      ëŒ€ìƒ: 'AutoMaker êµ¬ë§¤íŒ€ ë° í’ˆì§ˆê´€ë¦¬íŒ€',
      ìš”ì•½: 'ë°˜ë³µì ì¸ ë‚©ê¸° ì§€ì—°ê³¼ í’ˆì§ˆ ì´ìŠˆë¡œ ì¸í•œ ê³ ê° ë§Œì¡±ë„ í•˜ë½ ìš°ë ¤',
      ì¡°ì¹˜: 'í•µì‹¬ ë¶€í’ˆ 2ì°¨ ê³µê¸‰ì‚¬ í™•ë³´, í’ˆì§ˆ ê²Œì´íŠ¸ ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ë„ì…',
      ì˜ˆìƒíš¨ê³¼: 'ë‚©ê¸° ì¤€ìˆ˜ìœ¨ 95% ë‹¬ì„±, í’ˆì§ˆ ë¶ˆëŸ‰ë¥  50% ê°ì†Œ ê¸°ëŒ€'
    }
  },
  'TechSupplier': {
    aiRecommendation: `[ì „ëµëª…]: ê¸°ìˆ  íŒŒíŠ¸ë„ˆì‹­ ê°•í™” ì „ëµ
[ëŒ€ìƒ]: TechSupplier ê¸°ìˆ íŒ€ ë° êµìœ¡íŒ€
[ìš”ì•½]: ì‹ ê·œ ì œí’ˆ ë„ì…ì— ë”°ë¥¸ ê¸°ìˆ  ì§€ì› ìš”ì²­ ê¸‰ì¦. ê³ ê°ì‚¬ì˜ ê¸°ìˆ  ì—­ëŸ‰ ê°•í™”ë¥¼ í†µí•œ ì¥ê¸° íŒŒíŠ¸ë„ˆì‹­ êµ¬ì¶• ê¸°íšŒ.
[ì¡°ì¹˜]: 1) ì „ë‹´ ê¸°ìˆ  ì§€ì›íŒ€ êµ¬ì„±, 2) ì²´ê³„ì  êµìœ¡ í”„ë¡œê·¸ë¨ ê°œë°œ, 3) ê¸°ìˆ  ë¬¸ì„œ í‘œì¤€í™”
[ì˜ˆìƒ íš¨ê³¼]: ê³ ê° ê¸°ìˆ  ìë¦½ë„ í–¥ìƒ, ì¥ê¸° ê³„ì•½ í™•ë³´, ê¸°ìˆ  í˜‘ë ¥ ëª¨ë¸ í™•ì‚°

[ì „ëµëª…]: í”„ë¡œì íŠ¸ ê´€ë¦¬ íš¨ìœ¨í™”
[ëŒ€ìƒ]: í”„ë¡œì íŠ¸ ë§¤ë‹ˆì € ë° ì¼ì • ê´€ë¦¬íŒ€
[ìš”ì•½]: ë³µìˆ˜ í”„ë¡œì íŠ¸ ë™ì‹œ ì§„í–‰ìœ¼ë¡œ ì¸í•œ ë¦¬ì†ŒìŠ¤ ì¶©ëŒê³¼ ì¼ì • ì§€ì—° ë°œìƒ. ì²´ê³„ì  ìš°ì„ ìˆœìœ„ ê´€ë¦¬ í•„ìš”.
[ì¡°ì¹˜]: 1) ë¦¬ì†ŒìŠ¤ ë§¤íŠ¸ë¦­ìŠ¤ ê¸°ë°˜ ì¼ì • ê´€ë¦¬, 2) ë§ˆì¼ìŠ¤í†¤ ê¸°ë°˜ ì§„ë„ ì¶”ì , 3) ë¦¬ìŠ¤í¬ ì¡°ê¸° ê²½ë³´ ì‹œìŠ¤í…œ ë„ì…
[ì˜ˆìƒ íš¨ê³¼]: í”„ë¡œì íŠ¸ ì™„ë£Œìœ¨ 20% í–¥ìƒ, ê³ ê°ì‚¬ ì‹ ë¢°ë„ ì¦ì§„, ìˆ˜ì£¼ ê¸°íšŒ í™•ëŒ€`,
    parsedStrategy: {
      ì „ëµëª…: 'ê¸°ìˆ  íŒŒíŠ¸ë„ˆì‹­ ê°•í™” ì „ëµ',
      ëŒ€ìƒ: 'TechSupplier ê¸°ìˆ íŒ€ ë° êµìœ¡íŒ€',
      ìš”ì•½: 'ì‹ ê·œ ì œí’ˆ ë„ì…ì— ë”°ë¥¸ ê¸°ìˆ  ì§€ì› ìš”ì²­ ê¸‰ì¦',
      ì¡°ì¹˜: 'ì „ë‹´ ê¸°ìˆ  ì§€ì›íŒ€ êµ¬ì„±, ì²´ê³„ì  êµìœ¡ í”„ë¡œê·¸ë¨ ê°œë°œ',
      ì˜ˆìƒíš¨ê³¼: 'ê³ ê° ê¸°ìˆ  ìë¦½ë„ í–¥ìƒ, ì¥ê¸° ê³„ì•½ í™•ë³´'
    }
  }
};

/**
 * ëª©ì—… AI ìš”ì•½ ìƒì„±
 * @param {Object} params - { customer, evidence, issues }
 * @returns {Object} - ìš”ì•½ ê²°ê³¼
 */
async function summary({ customer, evidence, issues }) {
  console.log(`ğŸ¤– [MOCK] GPT ìš”ì•½ ìš”ì²­ - ê³ ê°ì‚¬: ${customer}`);
  
  // ì‹¤ì œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ì§€ì—°
  await new Promise(resolve => setTimeout(resolve, 1500));
  
  // ê³ ê°ì‚¬ì— ë”°ë¥¸ ë¯¸ë¦¬ ì •ì˜ëœ ì‘ë‹µ ë°˜í™˜
  const mockData = MOCK_SUMMARIES[customer] || MOCK_SUMMARIES['AutoMaker'];
  
  console.log(`âœ… [MOCK] GPT ìš”ì•½ ì™„ë£Œ - ${mockData.summary.length}ì`);
  
  return {
    customer,
    summary: mockData.summary,
    evidence,
    issues: issues || [],
    topIssues: mockData.topIssues,
    generatedAt: new Date().toISOString(),
    _isMock: true
  };
}

/**
 * ëª©ì—… AI ì „ëµ ì œì–¸ ìƒì„±
 * @param {Object} params - { customer, evidence, issues, summary }
 * @returns {Object} - ì „ëµ ì œì–¸ ê²°ê³¼
 */
async function strategy({ customer, evidence, issues, summary }) {
  console.log(`ğŸ¯ [MOCK] GPT ì „ëµ ì œì–¸ ìš”ì²­ - ê³ ê°ì‚¬: ${customer}`);
  
  // ì‹¤ì œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ì§€ì—°
  await new Promise(resolve => setTimeout(resolve, 2000));
  
  // ê³ ê°ì‚¬ì— ë”°ë¥¸ ë¯¸ë¦¬ ì •ì˜ëœ ì‘ë‹µ ë°˜í™˜
  const mockData = MOCK_STRATEGIES[customer] || MOCK_STRATEGIES['AutoMaker'];
  
  console.log(`âœ… [MOCK] GPT ì „ëµ ì œì–¸ ì™„ë£Œ - ${mockData.aiRecommendation.length}ì`);
  
  return {
    customer,
    aiRecommendation: mockData.aiRecommendation,
    parsedStrategy: mockData.parsedStrategy,
    evidence,
    issues: issues || [],
    summary,
    generatedAt: new Date().toISOString(),
    _isMock: true
  };
}

/**
 * ì¶”ê°€ ê³ ê°ì‚¬ë¥¼ ìœ„í•œ ë™ì  ëª©ì—… ìƒì„±
 */
function generateDynamicMock(customer) {
  return {
    summary: `${customer} ê³ ê°ì‚¬ì˜ ì£¼ìš” ì´ìŠˆ ë¶„ì„:

1. **í”„ë¡œì íŠ¸ ì§„í–‰ í˜„í™©**
   - ì •ìƒ ì§„í–‰ ì¤‘ì¸ í•­ëª©ë“¤
   - ì¼ë¶€ ì¼ì • ì¡°ì • í•„ìš”

2. **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ìƒíƒœ**
   - ì •ê¸° ë¯¸íŒ… ì •ìƒ ìš´ì˜
   - í”¼ë“œë°± ë°˜ì˜ í”„ë¡œì„¸ìŠ¤ ì›í™œ

3. **í’ˆì§ˆ ë° ë§Œì¡±ë„**
   - ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•œ ìˆ˜ì¤€
   - ì§€ì†ì ì¸ ê°œì„  ì˜ì§€ í™•ì¸`,
    topIssues: [
      { title: 'ì¼ì • ì¡°ì • ìš”ì²­', plan: 'í”„ë¡œì íŠ¸ íƒ€ì„ë¼ì¸ ê²€í† ', score: 3.0 },
      { title: 'í’ˆì§ˆ ê°œì„  ì œì•ˆ', plan: 'ê°œì„  ë°©ì•ˆ ìˆ˜ë¦½', score: 2.8 },
      { title: 'ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ìµœì í™”', plan: 'ë¯¸íŒ… ì£¼ê¸° ì¡°ì •', score: 2.5 }
    ]
  };
}

module.exports = {
  summary,
  strategy,
  generateDynamicMock,
  MOCK_SUMMARIES,
  MOCK_STRATEGIES
}; 