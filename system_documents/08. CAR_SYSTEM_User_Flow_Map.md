# Comad J CAR SYSTEM USER FLOW MAP

> 최종 업데이트: 2025-06-20
> 작성자: TECH ME Comad J
> 업데이트: 구현 완료 기준 최종본

> 목적: 전체 사용자 플로우 맵 초안 (기능 단위별 흐름 정리)

---

## 1. 공통 사용자 플로우

1. `/login`
   - ID, PW 입력 → 로그인 시도
   - 성공 시 → `/dashboard` 이동

---

## 2. 메인 대시보드 `/dashboard`

- 필터 입력 (회사, 고객사, 부서, 상태, 기간 등)
- KPI 카드 확인 (진행 중, 종료 등)
- 하단 차트 (진행률, 점수 분포, 생성 추이) 확인
- 테이블(Score Worst, 지연 Worst) 클릭 시 → 상세 팝업

---

### 2.1 전략 제언 팝업 (대시보드 고객사 카드 클릭시)

- LLM 기반 제언 (전략명 + 설명 + 효과)
- 최대 5줄 표시, 누락 시 fallback 메시지
- '닫기' 버튼 또는 '외부 영역 클릭' 으로 종료

---

### 2.2 차트 상호작용 흐름

- 사용자가 Pie/Bar/Line Chart 내 특정 항목을 클릭하면 → 해당 항목이 필터바에 반영됨
- 필터가 갱신되며 KPI 카드, 테이블, 전략 제언 팝업까지 전체 리렌더링됨
- 동일 항목 클릭 시 → 필터에서 제거되어 초기 상태로 복귀
- 필터 조합 및 차트 조합 병렬 적용 가능

---

## 3. CAR 목록 `/car/list`

- 필터 입력 후 검색
- 리스트 행 클릭 시 → CAR 상세 팝업 열림
- 우측 상단 → `+ 신규 등록` 클릭 시 `/car/create` 이동
- STAFF는 본인이 작성한 CAR에 대해서만 수정/삭제 버튼이 노출됨
- MANAGER/ADMIN은 전체 CAR에 대해 수정/삭제 가능
- 삭제 버튼 클릭 시 삭제 확인 모달이 뜨며, 확인 시 즉시 삭제됨

---

## 4. CAR 등록 `/car/create`
- 필드 입력 (회사명, 고객사, 부서, 이벤트 유형 등)
- 주관식 제언 내용 작성 (openIssue, followUpPlan 등)
- `저장` 클릭 시 등록 → `/car/list` 이동 & 팝업 알림
- 고객사, 부서, 담당자 등은 직접 입력이 아닌 고객정보 DB에서 불러와 선택
- 복수 담당자 선택 가능(자동 customerID 부여), `,`로 구분
- 고객사와 부서가 동일하면 중복 표시하지 않음
- 등록되지 않은 담당자일 경우 [+] 버튼을 통해 팝업 등록
- 고객 담당자 선택 시, 기존 Customer DB에서 드롭다운으로 선택
- 선택된 담당자에 따라 고객사/부서/담당자 정보 자동 맵핑
- 담당자가 없는 경우 [+] 버튼을 눌러 `고객사/부서/담당자/연락처/비고`를 입력 후 등록
- 복수 고객 담당자 등록 가능, `,`로 구분하여 입력
- 중복된 고객사/부서 정보는 한 번만 출력됨
- 고객 신규 등록 팝업 구조
```css
[신규 고객 등록 팝업 호출] 
   ↓
[신규 고객 정보 입력 → DB 저장] 
   ↓
[드롭다운 자동 갱신 + 입력 상태 유지]
```

---

## 5. CAR 상세 `/car/[id]`

- 기존 CAR 정보 자동 불러오기
- 하단 [목록으로], [수정하기] 버튼 존재
- 각 버튼 클릭시 `/car/list` 또는 `/car/[id]/edit`로 이동

---

## 6. CAR 수정 `/car/[id]/edit`

- 기존 CAR 정보 자동 불러오기
- 항목 수정 후 `저장`
- 저장 후 `/car/[id]`로 리다이렉트

---

## 7. CAR 삭제 `/car/[id]/delete`

- 삭제 버튼 클릭 시 확인 알림 모달
- `확인` 선택 시 삭제 → 리스트 자동 갱신
> 삭제 기능은 작성자 본인(STAFF 포함), MANAGER, 또는 ADMIN 권한 사용자만 수행할 수 있으며, 삭제는 리스트 페이지 또는 상세 보기에서 모달 확인 절차를 거쳐 즉시 처리됩니다. 삭제는 복구할 수 없으며, 별도의 휴지통 또는 되돌리기 기능은 제공되지 않습니다.

---

## 8. 관리자 페이지 `/admin`

- 관리자 권한만 접근 가능

### 8.1 사용자 관리 `/admin/users`
- 유저 목록 조회 및 상세 정보 열람
- 사용자 권한(Role: staff / manager / admin) 변경 가능
  - 단, 본인 계정에 대한 권한 변경은 불가
- 계정 삭제 시 '비활성화 처리'(soft-delete) 방식 사용
  - 삭제된 계정은 로그인 불가, 리스트에서 숨김
  - 복원은 관리자 콘솔을 통해 수동 처리
- 사용자 수정/삭제 시 변경 로그 기록 (userAuditLog)

### 8.2 이메일 리스트 `/admin/email-list`
- 경영진 메일 추가/삭제
- 잘못된 이메일 입력 시 에러 노출

---

## 9. 주간 리포트 흐름

- 매주 월요일 자동 생성 (`weeklyReport`)
- 각 고객사별 요약, 점수, 전략 포함
- 이메일 전송 (SendGrid API)
- 관리자/담당자는 `/dashboard` 또는 이메일 통해 열람

---

## 10. 권한 구조 (요약)

| 역할    | 권한 요약 |
|---------|-----------|
| ADMIN   | 전체 접근 가능 + 관리자 메뉴 |
| MANAGER | CAR 생성/수정/조회 가능 |
| STAFF   | 본인 생성 CAR만 수정/삭제 가능 |

---
