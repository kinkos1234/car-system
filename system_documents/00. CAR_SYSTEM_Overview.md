# CAR SYSTEM 프로젝트 개요서

최종 수정일: 2025-06-20
작성자 : TECH ME Comad J
업데이트: 구현 완료 기준 최종본

---

## 1. 프로젝트 개요

Comad J CAR(Customer Account Review) 시스템은  
VOC(Voice of Customer) 데이터를 통합 관리하고,  
AI 기반의 분석 및 전략 제언을 통해  
주간 리포팅 자동화까지 지원하는 내부 운영 플랫폼입니다.

기존에는 VOC 수집과 보고가 수기 기반으로 이루어져  
데이터 활용의 실효성이 낮고,  
전사적 피드백 분석 및 대응 체계에 한계가 있었습니다.

CAR 시스템은 이를 해소하고,  
각 지사의 VOC 데이터를 통합 관리하며,  
정기적인 전략 보고 프로세스를 표준화하고자 구축되었습니다.

---

## 2. 개발 목적

- 고객 VOC 데이터를 카테고리별로 수집, 스코어링, 누적 관리
- AI 기반 분석 및 전략 제언 자동화를 통한 주간 보고 효율화
- 내부 협업 및 대응 체계의 가시성 강화
- 글로벌/운영 환경에서는 PostgreSQL 등 RDBMS로 전환 가능(확장성 고려)

---

## 3. 핵심 기능

- VOC 등록, 조회, 수정, 삭제 기능 (법인별 권한 분기)
- LLM API를 활용한 전략 제언 자동 생성
- SendGrid 기반 주간 보고서 메일 자동 발송
- 누적 VOC 데이터 기반 대시보드 시각화
- JWT 기반 인증 및 어드민 권한 분리

---

## 4. 사용자 범위

- **본사 기획실**: VOC 기반 전략 제언 및 보고 자료 활용
- **글로벌 법인 담당자**: CAR 직접 등록 및 피드백 문서화
- **시스템 관리자**: 전사 VOC 데이터 검수 및 시스템 운영

---

## 5. 시스템 구성도 (요약)

```text
[사용자 (지사/본사)]
   ↕ (IP 필터링 + 로그인 → JWT 발급)
[Next.js 프론트엔드]
   ↕
[Node.js API 서버]
   ↔ LLM API (전략 제언 생성)
   ↔ 메일 발송 모듈 (자동 메일 발송)
   ↔ Prisma ORM / SQLite {개발/테스트용, PostgreSQL 전환 가능}
```

## 6. 향후 확장 계획

- 다국어 대응 (i18n 기반 한/영 스위치 적용 예정)
- 법인별 AI 제언 커스터마이징 구조 설계
- 퍼블릭 클라우드 서버 전환 및 IP 기반 보안 강화 (Azure 예정)
- 접속 이력 기록, 로그 분석 기능 추가

---

## 7. 시스템 사용자 권한 구조

### 7.1 권한별 기능 요약 표

| 권한 | 메뉴 접근 | 고객정보 삭제 | CAR 수정 | CAR 삭제 |
|------|-----------|----------------|-----------|-----------|
| admin | 전체 가능 | 가능 | 전체 가능 | 전체 가능 |
| manager | `/admin` 불가 | 불가 | 전체 가능 | 전체 가능 |
| staff | `/admin` 불가 | 불가 | 본인만 가능 | 본인만 가능 |


### ▸ admin
- 모든 메뉴 접근 및 모든 기능 사용 가능

### ▸ manager
- `/admin` 관련 메뉴 접근 불가
- `/car/customerdb` 접근 가능하나 **고객정보 삭제 불가**
- CAR 항목 전체 수정/삭제 가능

### ▸ staff
- `/admin` 접근 불가
- `/car/customerdb` 접근 가능하나 **고객정보 삭제 불가**
- CAR 항목 **본인 작성 건에 한해서만 수정/삭제 가능**

> 고객 담당자(customerContact) 정보는 `/car/customerdb` 경로에서 관리됩니다.
> 해당 정보의 삭제는 ADMIN 권한으로만 허용되며, MANAGER 및 STAFF는 삭제 버튼이 노출되지 않습니다.

---

## 8. 대시보드 상호작용 정책

- 필터 바는 대시보드 내 모든 구성 요소(KPI 카드, 차트, 테이블)에 전역적으로 영향을 미침
- 특정 차트 항목 클릭 시, 해당 항목은 필터에 **추가 적용**되며 UI 전체가 갱신됨
- 차트 항목을 다시 클릭하면 해당 항목만 필터에서 **제거**되며, 나머지 기존 필터는 그대로 유지됨
- KPI 카드 및 테이블 리스트도 동일한 필터 상태를 유지하며 데이터 필터링됨
- 필터 상태는 URL query로 반영되어 공유 및 재접속 시 동일한 뷰 유지 가능

---

## 9. 로그인 페이지 정책

- 로그인은 `/login` 경로에서 이루어지며, ID/PW 입력을 통해 JWT 토큰을 발급받음
- 입력 필드는 `email`, `password`로 구성되며, 유효성 검사 실패 시 inline 에러 메시지 노출
- 로그인 실패 시 `toast`로 오류 알림이 표시됨 (`아이디 또는 비밀번호를 확인해주세요.`)
- 성공 시 `/dashboard`로 리디렉션됨
- JWT는 클라이언트 sessionStorage에 저장되며, 이후 모든 API 호출 시 `Authorization` 헤더로 전송됨
- UI는 중앙 정렬된 다크모드 폼 구조이며, 사용자는 로그인 외 별도 기능 접근 불가

---

## 10. 네트워크 접근 및 다중 기기 지원

- 서버는 `0.0.0.0:4000`으로 바인딩되어 네트워크 내 다중 기기에서 접근 가능
- CORS 설정을 통해 다양한 호스트에서의 접근을 허용
- Next.js 프록시 설정은 IPv4(`127.0.0.1`)를 사용하여 안정적인 백엔드 연결 제공
- 로컬 네트워크 내 모든 기기에서 동일한 인증 및 기능 제공

---

## 11. 환경변수 및 설정 관리

- `.env` 파일을 통한 중앙화된 환경변수 관리
- 시스템명, 메일 설정, 데이터베이스 연결 등 핵심 설정을 환경변수로 관리
- 개발/운영 환경 간 설정 분리 지원
- 패키지 스크립트에서 하드코딩된 환경변수 제거하여 `.env` 우선순위 보장

---

## 12. 고객 정보 관리 개선

- 고객 담당자 정보를 별도 테이블(`CustomerContact`)로 분리
- CAR와 고객 담당자 간 N:M 관계 구현 (`CarCustomerContact` 중간 테이블)
- 고객 그룹 관리 기능 추가 (`group` 필드)
- 고객 정보 삭제는 ADMIN 권한으로 제한

---