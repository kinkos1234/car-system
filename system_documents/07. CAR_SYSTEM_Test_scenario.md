# Comad J CAR 시스템 테스트 시나리오 (최종)

> 최종 수정일: 2025-06-20
> 작성자: TECH ME Comad J
> 업데이트: 구현 완료 기준 최종본

> 이 문서는 CAR 시스템의 핵심 기능별 테스트 시나리오를 정의하여, 기능 구현 후의 품질 검증을 위해 사용됩니다.

---

## 1. 인증 및 접근 제어 테스트

### 1.1 로그인

- [x] ID: `admin`, PW: `comadj` 입력 시 `/dashboard`로 정상 리다이렉트됨
- [x] ID 존재하나 PW 오류 시 로그인 실패 메시지 출력
- [x] 로그인 성공 시 JWT 토큰이 localStorage에 저장됨
- [x] 토큰 만료 시 자동 로그아웃 처리 또는 리다이렉트됨

### 1.2 권한별 접근 제한

- [x] `admin`: 모든 기능, 사용자 관리 가능
- [x] `manager`: 사용자 관리 제외 모든 기능 접근 가능
- [x] `staff`: 본인이 등록한 CAR만 삭제 가능
- [x] 권한 없는 URL 접근 시 `/unauthorized` 또는 403 응답

- playwright, jest 등 일부 자동화 테스트 존재
- 시나리오별 커버리지/자동화 미흡, 수동 테스트 병행 필요

---

## 2. CAR 등록 및 관리 기능 테스트

### 2.1 CAR 등록

- [x] 필수값 입력 후 등록 버튼 → CAR 정상 생성
- [x] `dueDate` 누락 시 400 에러 발생 및 "마감일은 필수 항목입니다" 메시지 출력

### 2.2 CAR 수정/삭제

- [x] `admin`, `manager`: 전체 CAR 수정/삭제 가능
- [x] `staff`: 본인 작성 CAR만 삭제 가능

### 2.3 필드 검증

- [x] 날짜 필드 → `YYYY-MM-DD` 형식 확인
- [x] 점수 필드 (`importance`, `score`)는 float 형식만 허용
- [x] `createdAt`, `updatedAt` 자동 갱신 확인

- 주요 시나리오 수동/자동 혼합 테스트
- 날짜/점수 필드 등 일부 검증 로직 미흡

---

## 3. 대시보드 시각화 및 필터링 기능 테스트

### 3.1 상단 필터

- [x] 기간, 법인, 고객사, 부서 설정 시 모든 요소 동기화

### 3.2 카드 상호작용

- [x] 고객사 카드 클릭 → 차트/테이블 필터링됨
- [x] 카드 재클릭 → 필터 해제 및 초기화
- [x] 다른 카드 블러 처리 확인됨

### 3.3 차트 상호작용

- [x] 데이터 지점 클릭 → 카드/차트/테이블 필터링
- [x] 재클릭 → 강조 해제 및 초기화

### 3.4 테이블 동작

- [x] 필터링 결과만 반영, 클릭 이벤트 없음

- 상호작용/필터링 등 일부 시나리오 미구현/미흡

### 3.5 차트 상호작용 테스트 시나리오

- [x] 차트 항목 클릭 시 해당 값이 상단 필터에 추가됨
- [x] 추가된 필터에 따라 KPI 카드, 테이블, 다른 차트가 동기화됨
- [x] 동일 항목 재클릭 시 필터에서 제거되고 UI가 갱신됨
- [x] 다중 차트 항목 병렬 필터링 동작 확인
- [x] 필터 상태가 URL에 반영되어 새로고침 후에도 동일 상태 유지됨

---

## 4. 로그인 및 목록 페이지 시나리오

### 4.1 로그인 화면

- [x] 올바른 계정 입력 시 `/dashboard` 이동 확인
- [x] 잘못된 계정 입력 시 오류 메시지 노출
- [x] 빈 입력값 제출 시 유효성 경고 노출
- [x] 비로그인 상태에서 `/dashboard` 접근 시 `/login`으로 이동

### 4.2 CAR 목록 페이지

- [x] 필터 값 변경 시 테이블 반영 확인
- [x] 각 컬럼별 정렬 기능 작동 확인
- [x] 페이지네이션 정상 작동 여부 확인
- [x] “신규 등록” 버튼 클릭 시 등록 페이지 이동 여부 확인

---

## 5. AI 분석 및 점수 계산 테스트

### 5.1 score 계산

- [x] `internalScore`, `customerScore`, `subjectiveScore` 평균 산출 확인
- [x] Continuous CAR → `completionDate` 기준 `date_score` 정확히 계산됨

<!-- 2024-06-XX: analysisScore 항목 최종 구현에서 제외되어 해당 섹션 삭제 -->

- sentimentScore, score 등 자동화 테스트 미흡

---

## 6. AI 연동 및 예외 테스트 시나리오

### 6.1 전략적 제언 팝업/보고서
- [x] 대시보드 내 고객사별 요약 카드 클릭 시 팝업 정상 호출
- [x] 팝업 내 주요 이슈 요약, 전략적 제언, 최종 업데이트 일자 표시
- [x] 제안 내용 복사 시 토스트 알림 노출
- [x] 닫기 버튼 정상 동작

### 6.2 주간 보고서 자동 발송
- [x] 매주 월요일 오전 9시 HTML 기반 요약 메일 발송
- [x] PDF 첨부(선택적) 정상 동작

### 6.3 예외/실패/지연 처리
- [x] ChatGPT API 호출 실패 시 "제언 생성 실패" 메시지 및 최대 2회 재시도
- [x] 10초 이상 응답 지연 시 "AI 응답 지연 중" 안내, 20초 초과 시 실패 처리
- [x] 필수 필드 누락 시 "정보 부족" 표시 및 전체 집계/요약 포함
- [x] 요약 불가(비정상 응답 등) 시 원본 텍스트 일부(최대 500자)만 표시

### 6.4 관리자만 고객 정보 삭제 가능 여부 확인
- 관리자 로그인 후 /car/customerdb 접속
- 아무 고객 항목 선택 후 '삭제' 버튼 클릭
- 성공적으로 삭제되는지 확인

- manager/staff 로그인 후 동일 경로 접속
- '삭제' 버튼이 비노출되는지 확인

## 7. 전략 제언 파싱/출력
- LLM 응답이 라벨 기반/5줄/3줄/1줄/공백 등 다양한 케이스에서 전략 제언이 정상적으로 5개 항목에 매핑되는지 검증
- 5줄 미만이면 '-'로 채워지는지 확인

## 8. 보고서 생성/DB 저장
- /api/report/weekly/generate 실행 → DB/콘솔/메일/대시보드에서 데이터 일치 확인
- Prisma Studio 등에서 aiRecommendation, topIssues, summary 등 필드 검증 (SQLite 파일 기반)

## 9. 메일 발송/템플릿
- scripts/send-weekly-report.ts 실행 → 실제 메일 수신 및 표/본문 가독성 확인
- Outlook(Windows): 오른쪽 정렬 깨짐 없음 확인
- Gmail(Web): mj-section 내 컬럼 비율 1:2 비율 유지됨
- mjmlTemplates.ts의 mj-body width, section/column/table 구조, padding, 비율 기반 width 등 폭/가독성 테스트

## 10. 예외/에러 대응
- LLM 응답이 비정상(공백, 3줄, 1줄 등)일 때도 구조적으로 5개 항목이 출력되는지 확인
- 메일/보고서/대시보드 등 모든 경로에서 일관성 유지

## 11. 전체 파이프라인
- 데이터 집계 → LLM 파싱 → 보고서 생성 → 메일 발송 → UI/DB/메일 확인까지 end-to-end 테스트

---
