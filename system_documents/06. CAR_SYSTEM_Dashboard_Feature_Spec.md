# Comad J CAR 시스템 대시보드 기능 명세 (최종)

> 최종 수정일: 2025-06-20
> 작성자: TECH ME Comad J
> 업데이트: 구현 완료 기준 최종본

---

## 주요 기능 (2025-06 최신)
- 주간 보고서(weeklyReport) DB 연동: summary, topIssues, aiRecommendation, **evidence(근거)** 등 실시간 반영 (SQLite 파일 기반)
- **evidence(근거): 전체 이력 기반 전처리 요약/패턴/통계**
- 전략 제언 5개 항목(라벨+5줄 fallback, 5줄 미만 '-' 채움) 일관 출력
- Top5 이슈, 전략 제언, summary, evidence 등 메일/보고서와 동일한 데이터/포맷 사용
- 예외/에러 케이스(공백, 3줄, 1줄 등)도 구조적으로 대응
- UI/UX: 표 폭/여백/정렬 등 메일과 유사하게 시원한 레이아웃 유지

---

## 1. 주요 대시보드 구성요소

- 상단 필터: corporation, customer, customerDepartment, 기간(최근 30일)
- 카드/차트/테이블: 실제 구현은 문서와 유사하나, 일부 상호작용(블러, 강조 등) 미구현
- 월별 누적 집계, 담당자별 분석 등 고도화 규칙 미구현
- **전략 제언/이슈 요약/근거 evidence 모두 DB(WeeklyReport)에서 조회**

---

## 2. 필터링 조건

- 법인, 고객사, 부서, 상태 필터의 경우 실제 입력 내용을 기반으로 드롭다운 형성하며, 전체 항목을 추가하여 기본값은 전체로 설정
- 시작월, 종료월 필터의 경우 캘린더 선택 형식으로 하며, 기본값은 접속일 기준 최근 6개월로 설정

### 2.1 차트 상호작용 상세 정책

- 모든 차트는 클릭 가능한 데이터 포인트로 구성됨
- 클릭 시 해당 항목 값이 필터 상태에 추가되고, 모든 데이터가 동기화됨
- 재클릭 시 해당 필터는 해제됨 (토글 구조)
- 필터는 다중 항목 병렬 적용 가능
- 필터 상태는 URL에 유지되어 공유/재방문 시 동일 뷰로 재구성됨

---

## 3. 사용 기술 스택

- chart.js, shadcn/ui, TailwindCSS, zustand, tanstack-query 등 실제 구현 기준

---

## 4. 권한에 따른 노출 제한

- 실제 구현: staff 본인 등록 CAR 강조 등 일부 미구현

---

## 5. AI 전략적 제언 팝업/보고서 UI/UX 정책 (최신)

### 5.1 팝업/보고서 정보 구성
- 주요 이슈 요약(누적/현재), **전처리 evidence(근거)**, 전략적 제언, 최종 업데이트 일자 표시
- evidence(근거)는 전체 이력 기반 반복/장기/패턴 요약/통계 등
- 버튼: [제안 내용 복사] [닫기]
- 제안 내용 복사 시 "클립보드에 복사되었습니다" 토스트 알림
- 예시
```json
{
  "customer": "TESLA",
  "summary": { "totalEvents": 10, "avgSentiment": 45.3, "scoreSum": 6.7 },
  "topIssues": [
    { "title": "납기 지연", "plan": "물류 프로세스 개선", "score": 3.9 }
  ],
  "aiRecommendation": "전략명\n대상\n요약\n조치\n예상효과",
  "evidence": {
    "repeated": ["품질 이슈"],
    "longUnresolved": ["도장 공정 문제"],
    "trend": ["TESLA 고객사의 납기 클레임 증가"]
  }
}
```

### 5.2 트리거 및 인터랙션
- 수동 호출(대시보드 내 고객사별 요약 카드 클릭 시 팝업)
- 주간 보고서: 매주 월요일 오전 9시 자동 발송(HTML 기반)

### 5.3 예외/알림 정책
- AI 응답 지연 시 "AI 응답 지연 중" 안내, 20초 초과 시 실패 처리
- 제언 생성 실패 시 명확한 안내 메시지 표시
- evidence(근거) 누락/오류 시 fallback 안내

### 5.4 주간 보고서 DB 기반 조회 정책
- 대시보드/팝업 등에서 주간 보고서 데이터는 항상 DB(WeeklyReport)에서 조회한다.
- evidence(근거)도 함께 조회/표시
- 서버 재시작/배포와 무관하게 최신/과거 데이터를 안전하게 불러올 수 있다.

### 5.5주요 컴포넌트
- `FilterBar`: corporation, department, dateRange
- `SummaryCard`: 고객사 단위 Top5 요약
- `StrategyModal`: evidence + aiRecommendation + copy 버튼

---

## 6. 전략 제언/이슈 요약 재처리 정책
- 동일 고객사/기간에 대해 /api/report/weekly/generate를 재호출하면 해당 데이터는 덮어쓰기(update)됨
- 대시보드는 항상 DB(WeeklyReport) 기준으로 조회되므로, 분석 재처리 시 자동 반영됨
- 재처리 일시는 updatedAt 필드 기준으로 확인 가능
- 전략 제언/요약 로직 변경 시, 과거 데이터와 결과 차이 발생 가능 (주의 표시 필요)
- 운영자는 재처리 이력을 별도 로그에서 추적 가능

---

// 운영/확장 시 PostgreSQL 등 RDBMS로 전환 가능(확장성 고려)